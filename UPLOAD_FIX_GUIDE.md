# راهنمای حل مشکل آپلود و نمایش تصاویر در هاست

## مشکل
تصاویر آپلود می‌شوند ولی در هاست با خطای 404 نمایش داده می‌شوند.

## علت مشکل
1. فایل `.htaccess` در محیط تولید API ها را به `localhost:3001` هدایت می‌کرد
2. مسیرهای فایل‌های آپلود شده درست تنظیم نشده بودند
3. URL های تولید شده برای تصاویر صحیح نبودند

## راه‌حل پیاده‌سازی شده

### 1. اصلاح فایل `.htaccess`
- فایل `.htaccess.production` ایجاد شد که مخصوص محیط تولید است
- مسیریابی API به localhost حذف شد
- مسیریابی فایل‌های آپلود شده اضافه شد

### 2. اصلاح کنترلر آپلود
- تشخیص خودکار محیط (توسعه/تولید)
- تولید URL های صحیح بر اساس محیط
- استفاده از متغیر محیطی `NODE_ENV`

### 3. اسکریپت کپی `.htaccess`
- انتخاب خودکار فایل مناسب بر اساس محیط
- کپی فایل `.htaccess.production` برای محیط تولید

## نحوه استفاده

### برای محیط توسعه:
```bash
npm run build:dev
```

### برای محیط تولید:
```bash
npm run build
```

## تنظیمات سرور در هاست

### 1. متغیرهای محیطی
در سرور Node.js متغیرهای زیر را تنظیم کنید:
```bash
NODE_ENV=production
BASE_URL=https://ghesti.peykkhorshid.ir
```

### 2. ساختار پوشه‌ها در هاست
```
public_html/
├── index.html (فایل‌های build شده)
├── assets/
├── uploads/
│   └── images/
│       ├── image-1234567890-123456789.png
│       └── ...
└── .htaccess (فایل تولید شده)
```

### 3. تنظیمات Apache
اطمینان حاصل کنید که:
- `mod_rewrite` فعال است
- `mod_headers` فعال است
- فایل `.htaccess` در پوشه اصلی قرار دارد

## تست کردن

### 1. آپلود تصویر
- تصویر را آپلود کنید
- URL برگشتی باید به شکل زیر باشد:
  ```
  https://ghesti.peykkhorshid.ir/uploads/images/filename.png
  ```

### 2. نمایش تصویر
- URL تصویر را در مرورگر باز کنید
- باید تصویر نمایش داده شود

### 3. بررسی کنسول مرورگر
- خطای 404 نباید وجود داشته باشد
- درخواست‌های API باید موفق باشند

## عیب‌یابی

### اگر هنوز خطای 404 دارید:

1. **بررسی مسیر فایل**:
   ```bash
   ls -la /path/to/host/uploads/images/
   ```

2. **بررسی مجوزهای فایل**:
   ```bash
   chmod 755 /path/to/host/uploads/images/
   chmod 644 /path/to/host/uploads/images/*
   ```

3. **بررسی فایل `.htaccess`**:
   - مطمئن شوید فایل `.htaccess.production` کپی شده است
   - محتوای فایل را بررسی کنید

4. **بررسی لاگ‌های سرور**:
   - لاگ‌های Apache را بررسی کنید
   - لاگ‌های Node.js را بررسی کنید

## نکات مهم

- همیشه از `npm run build` برای محیط تولید استفاده کنید
- فایل‌های آپلود شده باید در پوشه `uploads/images/` قرار گیرند
- URL های تولید شده باید با دامنه اصلی شروع شوند
- مجوزهای فایل‌ها باید صحیح باشند

## پشتیبانی

اگر مشکل ادامه داشت:
1. لاگ‌های سرور را بررسی کنید
2. تنظیمات Apache را بررسی کنید
3. مجوزهای فایل‌ها را بررسی کنید
4. متغیرهای محیطی را بررسی کنید
